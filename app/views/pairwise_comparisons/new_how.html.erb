<!-- The Modal -->
<div id="myModal_how" class="modal">
 <!-- Modal content -->
 <div class="modal-content" style="padding-top: 34px !important;">
   <span class="close">&times;</span>
   <%= render partial: 'categorical_company_add.html.erb' %>
   <%= render partial: 'continuous_company_add.html.erb' %>

   <div id = "modal_cont">
   <h4 style = "color:#3d6ab1;font-weight:bold"> Add Your Own Feature</h4>
   <br>
   <hr style="margin-left: -24px; margin-right: -24px">
   <br>
   <p style = "font-weight:bold;font-size:1.25em;" > Categorical features are qualitative.</p>  <p style = "font-size:1.25em;">Examples
    include gender, race, and neighborhood. </p>

<p style = "font-weight:bold;font-size:1.25em;">Continuous features are quantitative. </p> <p style = "font-size:1.25em;"> Examples
include income level, the length of a part of a day, and
the time a payment is issued. </p> <br / >
<p style = "font-size:1.25em;"> Is your feature categorical or continuous? </p>

<form action="#" class = "add_form">
     <label style = "display:inline;margin-right:5%;">
       <input id = "cat" class="with-gap" name="group3" type="radio" checked />
       <span style = "color:black;font-size:1.3em;">Categorical</span>
     </label> <br/> <br/>
      <label style = "display:inline;margin-right:5%;">
        <input id = "con" class="with-gap" name="group3" type="radio" checked />
        <span style = "color:black;font-size:1.3em;">Continuous</span>
      </label>
</form>
<a class="waves-effect waves-dark btn" id = "next_btn" style = "margin-top:5%;margin-left:63%;width:20.5%;padding-top:0.7%;padding-bottom:5%;color:#FFFFFF;background-color:#3d6ab1;font-weight:bold;font-size:1.2em;"> NEXT </a>
</div>
 </div>
</div>

<style>
  [type="radio"]:checked + span:after,
  [type="radio"].with-gap:checked + span:before,
  [type="radio"].with-gap:checked + span:after {
   border: 2px solid #000000;
  }
  [type="radio"]:checked + span:after,
  [type="radio"].with-gap:checked + span:after {
   background-color: #000000;
  }
</style>

<%= render partial: 'about.html.erb' %>

<script type="text/javascript">


  $("#about_next_btn").click(function(event) {
     $(".contain_1").css('display', 'none');
     $(".contain").css('display', 'block');
    });

</script>

<div class = "contain" style = "display:none">
<h3 class="title">Feature Selection for Your Social Preference Model</h3>
<hr class = "feature-hr">
<p class = "feature-text" >
  Docial preference means which driver should receive the request when there are multiple drivers waiting for a ping. 
  In other words, <b>you act as the algorithm in this section.</b>
</p>
<div class="feature-image-block">
  <p class = "feature-text">
  Just like what you did for the previous selection, please choose the features the algorithm should take into 
  account when deciding which driver should get the request (0: Not Important - 1: Essential). If there other 
  features you believe the algorithm should use, please add your own at the bottom of the page.
  </p>
  <%= image_tag ('Feature_Selection.png'), :class => "feature-selection-image" %>
</div>

<table class = "feature-table striped highlight" id = "feat">
    <thead>
     <th>  </th>
     <th>  </th>
    </thead>
    <% a = get_ranges_ai %>
    <% b = get_ranges_ai_2 %>
    <% @features_by_category.to_a.shuffle.each do |k, v| %> <!-- randomize the order to reduce bias --> 
    <% wrote_sub_header = false %>
    <% v.each do |f| %> 
    <tr>

      <td>
        <% if  !wrote_sub_header %>
        <h5 class = "subheader"> <%= f.description %> </h5>
        <% wrote_sub_header = true %>
        <% end %>
        <div class="row">
          <div class="card ">
            <div class="card-content" style="padding: 24px 24px 100px 24px">
              <p class="feature-card-text" style="max-width:60%;float:left;word-wrap:break-word;vertical-align:middle"><%=f.name %></p>
              <form id = "range_form" action="#">
              <p class="range-field" style = "float:right">
                Importance <input type="text"  class = "weight" style = "border-bottom:none;width:7%;margin-right:10%;margin-top:0%;font-size:18px;font-family: "Helvetica Neue", sans-serif;" id="textInput-<%=f.id%>" value="<%= b.pop %>" >
                <input type="range"  style = "width:60%;float:right;font-size:20px;" id="test5-<%=f.id%>" min="0" max="100" value = "<%= a.pop %>" class="range-importance" onchange="updateTextInput(this.value, this.id);" />
              </p>
              </form>
            </div>
          </div>
        </div>
      </td>
      <% if f.description == "Your Own Feature(s) - Continuous" or f.description == "Your Own Feature(s) - Categorical" %>
        <td id = "yof-<%=f.id%>" style = "cursor:pointer;font-weight:bold;font-size:2em;"> &times; </td>
      <% end %>
    </tr>
    <% end %>
  <% end %>
</table>


<br> <br>

   <a id = "add" class="btn-floating btn-large waves-effect waves-light" style = "z-index:0;background-color:#3d6ab1;margin-left:10%;"><i class="material-icons">add</i></a> <p style = "font-weight:bold;font-size:1.25em;display:inline;margin-left:1%;"> Add Feature </p>
   <%= link_to 'NEXT', index_driver_path, method: :post, :class => "waves-effect waves-dark btn", :style => "z-index:0;margin-top:5%;margin-right:10vw;float:right;width:12.5%;padding-top:0.7%;padding-bottom:3%;color:#FFFFFF;background-color:#3d6ab1;font-weight:bold;font-size:1.2em;" %>

</div>

   <style>
      /* The Modal (background) */
      .modal {
       display: none; /* Hidden by default */
       position: fixed; /* Stay in place */
       z-index: 1; /* Sit on top */
       padding-top: 100px; /* Location of the box */
       padding-bottom: 80vh;
       left: 0;
       top: 0;
       width: 100%; /* Full width */
       height: 100vh; /* Full height */
       max-height: calc(100vh - 210px);
       overflow-y: auto;
       background-color: rgb(0,0,0); /* Fallback color */
       background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
      }
      /* Modal Content */
      .modal-content {
       background-color: #fefefe;
       margin: auto;
       padding: 0px;
       border: 1px solid #888;
       width: 60%;
      }
      /* The Close Button */
      .close {
       color: #aaaaaa;
       float: right;
       font-size: 28px;
       font-weight: bold;
      }
      .close:hover,
      .close:focus {
       color: #000;
       text-decoration: none;
       cursor: pointer;
      }
      .bullet {
        font-size: 1.5em;
        line-height: 17pt;
        font-weight: normal;
        padding-left: 10px;
      }
      strong {
        font-weight: bold;
        font-family: verdana;
      }
</style>
 <br> <br> <br> <br><br> <br> <br> <br><br> <br> <br> <br>

<style>
  input[type=range]::-webkit-slider-thumb {
   background-color: #3d6ab1;
 }

 input[type="range"]::-moz-range-thumb {
   background-color: #3d6ab1;
}

.row
{
  margin-bottom: -3%;
}
</style>



<script type="text/javascript">

  if ( <%= session[:about] %> == true) {
    console.log( <%= raw @survey_complete %>)
    $(".contain_1").css('display', 'none');
    $(".contain").css('display', 'block');
  }

 function updateTextInput(val, f) {
         id = Math.abs(parseInt(f.slice(f.length-2, f.length)))
         str = 'textInput' + '-' + id
         console.log(str)
         a = parseInt(val);
         b_a = a
         a = Math.floor(a / 10)
         a = a.toString();
         a = "0." + a
         if ( parseInt(val) == 0) {a = 0}
         if ( parseInt(val) > 0 && (Math.floor(parseInt(val)/10) == 0)) {a= "0.1"}
         if ( Math.floor(parseInt(val)/10) == 10) {a = 1}

         document.getElementById(str).value=a;
         post_weights(parseInt(<%= current_user.id %>), id, b_a);

       }

  function post_weights(user, feature, weight)
  {
    console.log(feature)

    $.ajax({
      url: "/new_how_ai?participant_id="+user+"&feature_id="+feature+"&weight="+weight+"&method="+'how_ai',
      type: "post",
      success: function(){
        console.log('Saved Successfully');
        //window.location.href = "/pairwise_comparisons"
      },
      error:function($xhr){
        console.log($xhr);
      }
    });
    console.log("made it")
  }





  var modal = document.getElementById("myModal_how");
  // Get the button that opens the modal
  var btn = document.getElementById("add");
  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];
  // When the user clicks the button, open the modal
  btn.onclick = function() {
   modal.style.display = "block";
   $("#modal_cont").css('display', 'block')
  }
  // When the user clicks on <span> (x), close the modal
  span.onclick = function() {
   modal.style.display = "none";
   $("#con_con").css('display', 'none')
   $("#cat_con").css('display', 'none')

  }
  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
      $("#con_con").css('display', 'none');
      $("#cat_con").css('display', 'none');
   }
  }

  $("#next_btn").click(function(event){
    if ($("#cat")[0].checked == true)
    {
      $("#modal_cont").css('display', 'none')
      $("#cat_con").css('display', 'block')
    }
    else  if  ($("#con")[0].checked == true) {
       $("#modal_cont").css('display', 'none')
       $("#con_con").css('display', 'block')
    }
});
</script>

<% @features_all.each do |fo| %>
<script type="text/javascript">
    $("#yof-<%=fo.id%>").click(function(event){
      $.ajax({
        url: "/features/<%=fo.id%>",
        type: "patch",
        success: function(){
          console.log('Saved Successfully');
          location.reload()
        },
        error:function($xhr){
          console.log($xhr);
        }
        });
      });
</script>
<% end %>
